@page "/aspenChange"  
@rendermode InteractiveServer  
@inject IJSRuntime JS

<PageTitle>AspenBkpChange</PageTitle>  

<h2>BlazorAspenBkpChange</h2>  

<p>请上传 bkp 文件开始进行版本转换。</p>  
<p>仅支持高版本转换为低版本。</p>
<p>文件大小限制为10 MB。</p>
<p>服务器不保存历史文件，请转化完成后立即下载新文件。</p>
<p>注意：</p>
<p>由于 PURE 数据库限制，不保证完全转换，</p>
<p>只保证转换完成之后可以打开，可能会弹出丢失数据库的警告，</p>
<p>运行之后可能会直接报错，但是可以查看所有模块的设置参数。</p>

@if (!string.IsNullOrEmpty(_message))  
{  
    <div class="alert alert-info">@_message</div>  
}  

<InputFile OnChange="HandleFileSelected" multiple />  

@if (_uploadedFiles.Any())  
{  
    <h4>已上传文件:</h4>  
    <ul>  
        @foreach (var file in _uploadedFiles)  
        {  
            <li>@file</li>
        }  
    </ul>  
}  

@* @if (!string.IsNullOrEmpty(_firstLine))  
{  
    <h4>文件第一行内容:</h4>  
    <p>@_firstLine</p>  
} *@

@if (!string.IsNullOrEmpty(_formattedContent))  
{  
    <h4>格式化匹配内容:</h4>  
    <p>文件版本号: @_aspenVersion</p>  
    <p>系统版本: @_systemVersion</p>  
    <p>创建人: @_username</p>
    <p>计算机名: @_computerName</p>
    <p>创建时间: @_creatTime</p>
    <p>使用的主数据库: @_mainDatabase</p>
    <p>Aspen版本描述: @_aspenVersionDescription</p>

    @if (_availableVersions.Any())
    {
        <label for="versionSelect">选择目标版本:</label>
        <select id="versionSelect" @bind="_selectedVersion">
            @foreach (var version in _availableVersions)
            {
                <option value="@version">@version</option>
            }
        </select>
        <button @onclick="SaveModifiedFile">保存修改后的文件</button>
    }
    else
    {
        <p>无法转换为更低版本。</p>
    }

    @if (!string.IsNullOrEmpty(_modifiedFilePath))
    {
        @* <a href="@_apiFilePath" download>
            使用API下载修改后的文件
        </a> *@

        <button @onclick="DownloadFileFromURL">
            下载转换后的文件
        </button>
    }
}  

@code {  
    
}
